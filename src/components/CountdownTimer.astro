---
interface Props {
  releaseDate: string;
  large?: boolean;
}

const { releaseDate, large = false } = Astro.props;

// Calculate time remaining until release
function getTimeRemaining(targetDate: string) {
  const now = new Date().getTime();
  const target = new Date(targetDate).getTime();
  const difference = target - now;

  if (difference <= 0) {
    return {
      days: 0,
      hours: 0,
      minutes: 0,
      seconds: 0,
      isExpired: true,
    };
  }

  return {
    days: Math.floor(difference / (1000 * 60 * 60 * 24)),
    hours: Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
    minutes: Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60)),
    seconds: Math.floor((difference % (1000 * 60)) / 1000),
    isExpired: false,
  };
}

const timeRemaining = getTimeRemaining(releaseDate);

const sizeClasses = large
  ? {
      container: 'gap-6 md:gap-8',
      number: 'text-5xl md:text-7xl lg:text-8xl',
      label: 'text-sm md:text-base',
      separator: 'text-4xl md:text-6xl',
    }
  : {
      container: 'gap-4',
      number: 'text-2xl',
      label: 'text-xs',
      separator: 'text-xl',
    };
---

<div class="countdown-timer" data-release-date={releaseDate} data-large={large}>
  {timeRemaining.isExpired ? (
    <div data-expired class="text-neon-cyan font-mono text-lg md:text-2xl font-semibold">
      Released!
    </div>
  ) : (
    <div data-timer-container class={`flex ${sizeClasses.container} items-center justify-center`}>
      <!-- Days -->
      <div class="flex flex-col items-center">
        <span data-days class={`font-mono ${sizeClasses.number} font-bold text-neon-cyan tabular-nums`}>
          {String(timeRemaining.days).padStart(2, '0')}
        </span>
        <span class={`${sizeClasses.label} text-text-secondary uppercase tracking-wider`}>Days</span>
      </div>
      <span class={`text-neon-cyan font-mono ${sizeClasses.separator}`}>:</span>
      <!-- Hours -->
      <div class="flex flex-col items-center">
        <span data-hours class={`font-mono ${sizeClasses.number} font-bold text-neon-cyan tabular-nums`}>
          {String(timeRemaining.hours).padStart(2, '0')}
        </span>
        <span class={`${sizeClasses.label} text-text-secondary uppercase tracking-wider`}>Hours</span>
      </div>
      <span class={`text-neon-cyan font-mono ${sizeClasses.separator}`}>:</span>
      <!-- Minutes -->
      <div class="flex flex-col items-center">
        <span data-minutes class={`font-mono ${sizeClasses.number} font-bold text-neon-cyan tabular-nums`}>
          {String(timeRemaining.minutes).padStart(2, '0')}
        </span>
        <span class={`${sizeClasses.label} text-text-secondary uppercase tracking-wider`}>Min</span>
      </div>
      <span class={`text-neon-cyan font-mono ${sizeClasses.separator}`}>:</span>
      <!-- Seconds -->
      <div class="flex flex-col items-center">
        <span data-seconds class={`font-mono ${sizeClasses.number} font-bold text-neon-cyan tabular-nums`}>
          {String(timeRemaining.seconds).padStart(2, '0')}
        </span>
        <span class={`${sizeClasses.label} text-text-secondary uppercase tracking-wider`}>Sec</span>
      </div>
    </div>
  )}
</div>

